import tkinter as tk
from tkinter import messagebox
from PIL import Image, ImageTk  # Import Pillow for resizing images
import remote_services  # ✅ Import service checking module

def show_automate_services():
    """ ✅ Update service statuses in the GUI """
    for widget in automateservices_frame.winfo_children():
        widget.destroy()  # ✅ Clear old labels

    service_statuses = remote_services.check_remote_servicess()  # ✅ Get service statuses

    # ✅ Display service names & statuses
    for i, (service, status) in enumerate(service_statuses.items()):
        tk.Label(automateservices_frame, text=service, font=("Arial", 10), anchor="w").grid(row=i, column=0, sticky="w", padx=5, pady=2)
        tk.Label(automateservices_frame, text=status, font=("Arial", 10), fg="green" if status == "Running" else "red").grid(row=i, column=1, padx=5, pady=2)

    # ✅ Add "Stop All" button
    stop_button = tk.Button(automateservices_frame, text="STOP ALL SERVICES", font=("Bold", 12), bg="red", fg="white", command=stop_automate_services)
    stop_button.grid(row=len(service_statuses) + 1, column=0, columnspan=2, pady=10)

def stop_automate_services():
    """ ✅ Stop all running services """
    stopped_services, failed_services = remote_services.stop_all_services()

    # ✅ Show success/failure messages
    if stopped_services:
        messagebox.showinfo("Services Stopped", f"Successfully stopped:\n" + "\n".join(stopped_services))
    if failed_services:
        messagebox.showwarning("Failed to Stop", f"Could not stop:\n" + "\n".join(failed_services))

    # ✅ Refresh status
    show_automate_services()

def automateservices_page():
    """ ✅ Display the Automate Services Page """
    delete_pages()  # ✅ Clear previous content

    global automateservices_frame
    automateservices_frame = tk.Frame(main_frame)
    automateservices_frame.pack(pady=10, fill="both", expand=True)

    # ✅ Show services when page loads
    show_automate_services()

def delete_pages():
    """ ✅ Clears all previous page content """
    for frame in main_frame.winfo_children():
        frame.destroy()

def indicate(lb, page):
    hide_indicators()
    lb.config(bg='#158aff')
    delete_pages()
    page()

def hide_indicators():
    home_indicate.config(bg='#c3c3c3')
    automateservices_indicate.config(bg='#c3c3c3')

# GUI Setup
root = tk.Tk()
root.geometry('700x500')
root.title('CyberSecurity Audit Application')

# Sidebar container frame
sidebar_frame = tk.Frame(root, bg='#c3c3c3')

# Options Frame
options_frame = tk.Frame(sidebar_frame, bg='#c3c3c3', width=140, height=600)
options_frame.configure(width=140, height=600)

# Load and Resize Logo
image_path = r"C:\Users\amaan\Desktop\Coding\doggy.jpg"
try:
    original_image = Image.open(image_path)
    resized_image = original_image.resize((95, 95), Image.LANCZOS)
    logo_img = ImageTk.PhotoImage(resized_image)

    logo_label = tk.Label(sidebar_frame, image=logo_img, bg='#c3c3c3')
    logo_label.pack(pady=10)
except Exception as e:
    print(f"Error loading logo: {e}")

# Create indicators
home_indicate = tk.Label(options_frame, text='', bg='#c3c3c3')
home_indicate.grid(row=0, column=0, sticky="w", padx=5)

automateservices_indicate = tk.Label(options_frame, text='', bg='#c3c3c3')
automateservices_indicate.grid(row=1, column=0, sticky="w", padx=5)

options_frame.grid_columnconfigure(1, weight=1)

# Home Button
home_btn = tk.Button(
    options_frame, text='HOME', font=('Bold', 15),
    fg='#158aff', bd=0, bg='#c3c3c3', relief='flat',
    command=lambda: indicate(home_indicate, lambda: None)
)
home_btn.grid(row=0, column=1, sticky="ew", padx=10, pady=10)

# Automate Services Button
automateservices_btn = tk.Button(
    options_frame, text='AUTOMATE\nSERVICES', font=('Bold', 15),
    fg='#158aff', bd=0, bg='#c3c3c3', relief='flat',
    command=lambda: indicate(automateservices_indicate, automateservices_page)
)
automateservices_btn.grid(row=1, column=1, sticky="ew", padx=10, pady=10)

# Pack everything
options_frame.pack(fill="both", expand=False)
sidebar_frame.pack(side=tk.LEFT, fill="y")

# Main content area
main_frame = tk.Frame(root, highlightbackground='black', highlightthickness=2)
main_frame.pack(side=tk.LEFT, fill="both", expand=True)

root.mainloop()


## YOU HAVE TO WRITE THE AUTOMATE SERVICES CODE FIRST WHICH AUTOMATES THE SERVICE BRO< YOU TOTATLLY FORGOT ABOUT THIS. 
# YOUR CODE ONLY TELLS THE SERVICES ARE STOPPED OR NOT IN THE PDF